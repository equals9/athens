{"version":3,"sources":["athens/effects.cljs"],"mappings":"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","names":["G__61006","G__61007","re-frame.core/reg-fx","datoms","cljs.core.prn.cljs$core$IFn$_invoke$arity$variadic","cljs.pprint.pprint.cljs$core$IFn$_invoke$arity$1","posh.reagent/transact!","athens.db/dsdb","cljs.core/println","G__61008","G__61009","new-db","datascript.core.reset_conn_BANG_.cljs$core$IFn$_invoke$arity$2","G__61010","G__61011","_","js/localStorage.setItem","cljs.core/deref","datascript.transit/write-transit-str","G__61012","G__61013","p__61014","map__61015","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","cljs.core.get.cljs$core$IFn$_invoke$arity$2","url","method","opts","on-success","on-failure","c__34273__auto__","cljs.core.async.chan.cljs$core$IFn$_invoke$arity$1","cljs.core.async.impl.dispatch/run","f__34274__auto__","switch__34206__auto__","state_61059","state_val_61060","inst_61026","inst_61028","inst_61029","cljs.core/not","statearr-61061","statearr-61062","statearr-61063","G__61064","cljs.core/Keyword","statearr-61065","statearr-61066","statearr-61067","statearr-61068","js/Error","statearr-61069","statearr-61070","inst_61039","statearr-61071","statearr-61072","inst_61049","inst_61051","inst_61052","statearr-61073","statearr-61074","statearr-61075","inst_61023","inst_61024","cljs.core.async.impl.ioc-helpers/take!","inst_61057","cljs.core.async.impl.ioc-helpers/return-chan","statearr-61076","statearr-61077","statearr-61078","inst_61044","statearr-61079","inst_61047","inst_61048","statearr-61080","statearr-61081","statearr-61082","inst_61042","statearr-61083","statearr-61084","inst_61054","inst_61055","statearr-61085","inst_61031","inst_61032","inst_61033","inst_61034","inst_61035","statearr-61086","statearr-61087","statearr-61088","state-machine__34207__auto__","ret-value__34208__auto__","result__34209__auto__","cljs.core/keyword-identical?","e61089","js/Object","ex__34210__auto__","statearr-61090","cljs.core.async.impl.ioc-helpers/process-exception","state__34275__auto__","statearr-61091","cljs.core.async.impl.ioc-helpers/USER-START-IDX","cljs.core.async.impl.ioc-helpers/run-state-machine-wrapped","cljs-http.client/post","cljs-http.client/get","cljs-http.client/put","cljs-http.client/delete","re-frame.core/dispatch","cljs.core.conj.cljs$core$IFn$_invoke$arity$2","G__61094","G__61095","timers","cljs.core.atom.cljs$core$IFn$_invoke$arity$1","p__61096","map__61097","action","id","event","wait","G__61099","cljs.core.swap_BANG_.cljs$core$IFn$_invoke$arity$4","cljs.core/assoc","js/setTimeout","js/clearTimeout","cljs.core.swap_BANG_.cljs$core$IFn$_invoke$arity$3","cljs.core/dissoc"],"sourcesContent":["(ns athens.effects\n  (:require\n    [athens.db :as db]\n    [cljs-http.client :as http]\n    [cljs.core.async :refer [go <!]]\n    [cljs.pprint :refer [pprint]]\n    [datascript.core :as d]\n    [datascript.transit :as dt]\n    [day8.re-frame.async-flow-fx]\n    [posh.reagent :refer [transact!]]\n    [re-frame.core :refer [dispatch reg-fx]]))\n\n\n;;; Effects\n\n\n(reg-fx\n  :transact\n  (fn [datoms]\n    (prn \"INPUTS\")\n    (pprint datoms)\n    (prn \"OUTPUTS\")\n    (pprint (:tx-data (transact! db/dsdb datoms)))\n    (println)))\n\n\n(reg-fx\n  :reset-conn\n  (fn [new-db]\n    (d/reset-conn! db/dsdb new-db)))\n\n\n(reg-fx\n  :set-local-storage-db\n  (fn [_]\n    (js/localStorage.setItem \"datascript/DB\" (dt/write-transit-str @db/dsdb))))\n\n\n(reg-fx\n  :http\n  (fn [{:keys [url method opts on-success on-failure]}]\n    (go\n      (let [http-fn (case method\n                      :post http/post :get http/get\n                      :put http/put :delete http/delete)\n            res     (<! (http-fn url opts))\n            {:keys [success body] :as all} res]\n        (if success\n          (dispatch (conj on-success body))\n          (dispatch (conj on-failure all)))))))\n\n\n(reg-fx\n  :timeout\n  (let [timers (atom {})]\n    (fn [{:keys [action id event wait]}]\n      (case action\n        :start (swap! timers assoc id (js/setTimeout #(dispatch event) wait))\n        :clear (do (js/clearTimeout (get @timers id))\n                   (swap! timers dissoc id))))))\n\n"]}