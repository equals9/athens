{"version":3,"sources":["athens/devcards/node_page.cljs"],"mappings":"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","names":["p__68203","map__68204","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","cljs.core.get.cljs$core$IFn$_invoke$arity$2","athens.devcards.node-page/node-page-el","children","uid","title","editing-uid","linked-refs","unlinked-refs","cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2","komponentit.autosize/textarea","e","iter__4582__auto__","s__68207","cljs.core/LazySeq","temp__5735__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__4580__auto__","size__4581__auto__","cljs.core/count","b__68209","cljs.core/chunk-buffer","i__68208","cljs.core._nth.cljs$core$IFn$_invoke$arity$2","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__68206","cljs.core/chunk-rest","cljs.core/first","cljs.core/cons","cljs.core/rest","child","athens.devcards.blocks/block-el","s__68211","b__68213","i__68212","iter__68210","ref","s__68215","b__68217","i__68216","iter__68214","athens.devcards.node-page/node-page-component","ident","cljs.core/deref","node","posh.reagent/pull","athens.db/dsdb","athens.db/node-pull-pattern","athens.db/sort-block","G__68218","re-frame.core/subscribe","clojure.string/blank?","linked-ref-entids","G__68219","G__68220","G__68221","posh.reagent/q","athens.db/q-refs","athens.patterns/linked","unlinked-ref-entids","G__68222","G__68223","G__68224","athens.patterns/unlinked","cljs.core/chunk-first"],"sourcesContent":["(ns athens.devcards.node-page\n  (:require\n    [athens.db :as db]\n    [athens.devcards.blocks :as blocks]\n    [athens.patterns :as patterns]\n    [cljsjs.react]\n    [cljsjs.react.dom]\n    [devcards.core :refer-macros [defcard-rg]]\n    [komponentit.autosize :as autosize]\n    [posh.reagent :refer [pull q]]\n    [re-frame.core :refer [subscribe]]))\n\n\n;;; Components\n\n\n(defn node-page-el\n  [{:block/keys [children uid] title :node/title} editing-uid linked-refs unlinked-refs]\n  [:div\n\n   ;; Header\n   [:div {:data-uid uid :class \"page-header\"}\n    (if (= uid editing-uid)\n      [:h1\n       [autosize/textarea\n        {:value      title\n         :style      {:width \"100%\"}\n         :auto-focus true\n         :on-change  (fn [e]\n                       [:transact-event [[:db/add [:block/uid uid] :node/title (.. e -target -value)]]])}]]\n      [:h1 title])]\n\n   [:div\n    (for [child children]\n      ^{:key (:db/id child)} [blocks/block-el child])]\n   ;; TODO references\n   [:div\n    [:h4 \"Linked References\"]\n    (for [ref linked-refs]\n      ^{:key ref} [:p ref])]\n   [:div\n    [:h4 \"Unlinked References\"]\n    (for [ref unlinked-refs]\n      ^{:key ref} [:p ref])]])\n\n\n(defn node-page-component\n  \"One diff between datascript and posh: we don't have pull in q for posh\n  https://github.com/mpdairy/posh/issues/21\"\n  [ident]\n  (let [node (->> @(pull db/dsdb db/node-pull-pattern ident) (db/sort-block))\n        title (:node/title node)\n        editing-uid @(subscribe [:editing-uid])]\n    (when-not (clojure.string/blank? title)\n      (let [linked-ref-entids     @(q db/q-refs db/dsdb (patterns/linked title))\n            unlinked-ref-entids   @(q db/q-refs db/dsdb (patterns/unlinked title))]\n        [node-page-el node editing-uid linked-ref-entids unlinked-ref-entids]))))\n\n\n;;; Devcards\n\n\n(defcard-rg Node-Page\n  \"pull entity 4093: \\\"Hyperlink\\\" page\"\n  [node-page-component 4093])\n"]}